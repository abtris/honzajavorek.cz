<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Javorové lístky</title><link href="http://www.honzajavorek.cz" rel="alternate"></link><link href="http://www.honzajavorek.cz/feeds/mod_rewrite.xml" rel="self"></link><id>http://www.honzajavorek.cz</id><updated>2008-08-27T08:10:00+02:00</updated><entry><title>Pár triků pro mod_rewrite a .htaccess</title><link href="http://www.honzajavorek.cz/blog/par-triku-pro-mod_rewrite-a-htaccess.html" rel="alternate"></link><updated>2008-08-27T08:10:00+02:00</updated><author><name>Honza Javorek</name></author><id>http://www.honzajavorek.cz/blog/par-triku-pro-mod_rewrite-a-htaccess.html</id><summary type="html">&lt;p&gt;Velmi často je součástí webového serveru tzv. &lt;code&gt;mod_rewrite&lt;/code&gt;, který
nám povoluje přepisovat jakékoliv požadavky od uživatele na jiné.
Například přepsat nebo přesměrovat adresu. Více o &lt;code&gt;mod_rewrite&lt;/code&gt; a
souboru &lt;code&gt;.htaccess&lt;/code&gt;, jenž s ním úzce souvisí, najdete třeba na
&lt;a href="http://www.jakpsatweb.cz/server/htaccess.html"&gt;Jak psát web&lt;/a&gt;. Ta
nejlepší helpka je však velmi pěkně napsaný
&lt;a href="http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html"&gt;originální manuál&lt;/a&gt;.
Já se zkusím podělit o několik užitečných &lt;em&gt;code snippets&lt;/em&gt;, které
jsem časem nashromáždil…&lt;/p&gt;
&lt;h2&gt;Lomítka na koncích&lt;/h2&gt;
&lt;p&gt;Přesměruje adresy &lt;code&gt;tralala.com/venku/je/tma&lt;/code&gt; na
&lt;code&gt;tralala.com/venku/je/tma/&lt;/code&gt;.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;## endslashes&lt;/span&gt;
&lt;span class="n"&gt;RewriteCond&lt;/span&gt; &lt;span class="c"&gt;%{REQUEST_FILENAME} !-f&lt;/span&gt;
&lt;span class="n"&gt;RewriteCond&lt;/span&gt; &lt;span class="c"&gt;%{ENV:REDIRECT_STATUS} ^$&lt;/span&gt;
&lt;span class="n"&gt;RewriteCond&lt;/span&gt; &lt;span class="c"&gt;%{REQUEST_URI} !\/$&lt;/span&gt;
&lt;span class="n"&gt;RewriteRule&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;.*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; $0&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;301&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;NE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Hezká a všelijaká URL pro aplikaci v PHP&lt;/h2&gt;
&lt;p&gt;Žádných složitých 50 regulárních výrazů na to, co vlastně s těmi
adresami chceme… Stačí jeden kouzelný řádek, který úplně vše
přesměruje na &lt;code&gt;index.php&lt;/code&gt; a potom si adresu rozparsujeme přímo
v PHP (dostupná v &lt;code&gt;$_SERVER['REQUEST_URI']&lt;/code&gt;).&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;RewriteCond&lt;/span&gt; &lt;span class="c"&gt;%{REQUEST_FILENAME} !-f&lt;/span&gt;
&lt;span class="n"&gt;RewriteCond&lt;/span&gt; &lt;span class="c"&gt;%{REQUEST_FILENAME} !-d&lt;/span&gt;
&lt;span class="n"&gt;RewriteRule&lt;/span&gt; &lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;php&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Přesměrování RSS na FeedBurner&lt;/h2&gt;
&lt;p&gt;Chcete &lt;a href="http://www.feedburner.com"&gt;statistiky přístupů&lt;/a&gt; na vaše
RSS, ale nechcete obtěžovat odběratele článků se změnami adresy?
Přesměrujte je. Není to tak snadné jak se zdá, protože přesměrování
se nesmí provést, když se na váš &lt;em&gt;feed&lt;/em&gt; snaží dostat samotný
FeedBurner (to se pak logicky zacyklí). Sofistikovanější postupy
pro WordPress najdete
v &lt;a href="http://www.askapache.com/htaccess/redirecting-wordpress-feeds-to-feedburner.html"&gt;článku na AskApache&lt;/a&gt;,
já jsem si vystačil s tímto:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;## feedburner&lt;/span&gt;
&lt;span class="n"&gt;RewriteCond&lt;/span&gt; &lt;span class="c"&gt;%{HTTP_USER_AGENT} !^.*(FeedBurner|FeedValidator|Recent) [NC]&lt;/span&gt;
&lt;span class="n"&gt;RewriteRule&lt;/span&gt; ^&lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;?$ &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;feeds&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;feedburner&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;javorovelistky&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;302&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Chybové stránky&lt;/h2&gt;
&lt;p&gt;Pokud zadáte relativní cestu, původní URL zůstane v adresním řádku
prohlížeče a zobrazí se vám tato chybová stránka. Pokud zadáte
absolutní, přesměruje se chyba zcela na soubor s chybovou stránkou
(což podle mě není dobrý nápad).&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;## errorpages&lt;/span&gt;
&lt;span class="n"&gt;ErrorDocument&lt;/span&gt; 404 &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;joss&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;?&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;_404&lt;/span&gt;
&lt;span class="n"&gt;ErrorDocument&lt;/span&gt; 403 &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;joss&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;?&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;_403&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Tatíček .htaccess&lt;/h2&gt;
&lt;p&gt;Neodolal jsem a nakonec ještě přidám několik osvědčených kousků
i pro samotný &lt;code&gt;.htaccess&lt;/code&gt;. Někdy je dobré na web jen na oko zamezit
přístup, alespoň přes hlavní stránku. Jelikož ta se většinou volá
přes &lt;code&gt;index.php&lt;/code&gt;, teoreticky stačí vložit do rootu webu
&lt;code&gt;index.html&lt;/code&gt; a něco do něj napsat. Toto zajistí, že se určitě bude
HTML verze zobrazovat prioritně:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="n"&gt;DirectoryIndex&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;php&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Skryté soubory by se neměly nikomu dostat do rukou. Správný server
má toto už v globálním nastavení, ale člověk nikdy neví…&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;Files&lt;/span&gt; &lt;span class="err"&gt;~&lt;/span&gt; &lt;span class="err"&gt;&amp;quot;^[\.]&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    Order allow,deny
    Deny from all
    Satisfy All
&lt;span class="nt"&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Nevíte jestli na cílovém serveru bude &lt;code&gt;mod_rewrite&lt;/code&gt; a nechcete
riskovat &lt;em&gt;Internal Server Error 500&lt;/em&gt;? Stačí vše obalit podmínkou…&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span class="err"&gt;mod_rewrite.c&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
RewriteEngine on
...
&lt;span class="nt"&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A co tak si nastavit PHP?&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span class="err"&gt;mod_php5.c&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
# development setting
php_flag display_errors 1
# safety
php_flag register_globals 0
# allowed stealing from other websites ;)
php_flag allow_url_fopen 1
# fu*king quotes...
php_flag magic_quotes_gpc 0
php_flag magic_quotes_runtime 0
php_flag magic_quotes_sybase 0
# yes, I love short open tags!
php_flag short_open_tag 1
# utf forever
php_flag default_charset utf-8
&lt;span class="nt"&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Závěrem&lt;/h2&gt;
&lt;p&gt;Pokud byste měli nějaké další dobré tipy, podělte se v komentářích.
Doufám, že se vám tyto útržky kódu budou hodit a usnadní vám život.
Ne že bych byl expert na &lt;code&gt;mod_rewrite&lt;/code&gt; nebo nastavení Apache přes
&lt;code&gt;.htaccess&lt;/code&gt;, ale už z toho co umím mohu usoudit, že jsou to opravdu
silné a velmi užitečné nástroje, bez nichž bych si dneska pohyb po
hostinzích nebo vlastním serveru představil jen stěží. Mnohdy je
sice možné řešit totéž jiným způsobem, ale touto cestou je to
mnohdy rychlejší, elegantnější a na pohled hezčí :) . Takže kdo
s nimi ještě nezačal… Hurá do toho!&lt;/p&gt;</summary><category term="apache"></category><category term="mod_rewrite"></category><category term="php"></category><category term="projekty"></category><category term="webdesign"></category></entry></feed>